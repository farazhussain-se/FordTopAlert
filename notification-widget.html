<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Safety Notification Widget</title>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 480px) {
            body { padding: 0 !important; }
            .widget-container { border-radius: 0 !important; min-height: 100vh; }
        }
    </style>
</head>
<body style="margin: 0; padding: 16px; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: #f5f5f5; min-height: 100vh;">
    <div class="widget-container" style="max-width: 420px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); overflow: hidden; padding: 3px 0;">
        <div class="widget-header" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 16px 20px; text-align: center;">
            <h1 style="font-size: 18px; font-weight: 600; margin: 0 0 2px 0;">‚ö†Ô∏è Safety Alert</h1>
            <p id="current-date" style="font-size: 12px; opacity: 0.85; margin: 0;"></p>
        </div>

        <div id="notification-content" style="animation: fadeIn 0.3s ease-in;">
            <!-- Notification will be inserted here -->
        </div>

        <div id="signage-board" style="display: none;">
            <!-- Digital signage will be inserted here -->
        </div>
    </div>

    <script>
        // Message database with different categories
        const messages = {
            safety: [
                "CRITICAL: Near-miss incident at Station 7, Line 2. Employee's hand came within 6 inches of moving conveyor pinch point. All operators must review pinch point safety procedures immediately.",
                "URGENT: Chemical spill occurred in Assembly Zone C at 9:45 AM. Area has been contained and cleaned. All personnel must verify emergency spill kit locations at their stations.",
                "SAFETY INCIDENT: Forklift collision with pallet rack in Zone B resulted in minor structural damage. No injuries. Enhanced spotters now required for all forklift operations in this area.",
                "CRITICAL ALERT: Emergency stop was activated on Line 3 due to part jam. One operator narrowly avoided hand injury. Mandatory refresher on emergency stop locations required for all shifts.",
                "URGENT NOTICE: Lockout/Tagout violation discovered on Line 1 hydraulic press. Equipment was energized during maintenance. Zero tolerance policy reminder - verify energy isolation before any service work.",
                "SAFETY ALERT: Overhead crane load dropped in Assembly Area A due to rigging failure. No personnel injuries. All crane operations suspended pending inspection. Ground-level movement only until further notice.",
                "CRITICAL: Repetitive strain injury reported by 3 operators on Line 2 Station 5. Ergonomic assessment completed. New work rotation schedule mandatory effective immediately to prevent further injuries.",
                "INCIDENT REPORT: Slip and fall in Assembly Zone D due to hydraulic fluid leak. Employee transported for evaluation. All floor leaks must be reported immediately. Increased inspection frequency implemented.",
                "URGENT SAFETY NOTICE: Electrical arc flash occurred during maintenance on Line 1 control panel. No injuries due to proper PPE usage. All electrical work now requires two-person team and arc-rated gear.",
                "CRITICAL ALERT: Robotic arm on Line 3 Station 4 moved unexpectedly during setup, striking tool cart. Safety interlock malfunction identified and repaired. All robotic cells require pre-shift verification before operation."
            ],
            general: [
                "Production meeting rescheduled to 3 PM in Break Room A. Line leads please attend.",
                "New part bins delivered to Stations 5-8. Verify bin labels match work order specifications.",
                "Quality inspection scheduled for Line 2 tomorrow at 10 AM. Continue normal operations.",
                "Break schedule adjustment: Second shift breaks moved to :15 and :45 past the hour.",
                "Maintenance window Sunday 6 AM - 2 PM. Lines 1 and 3 will be offline for preventive maintenance.",
                "Updated work instructions posted at each station. Review changes before starting production runs.",
                "Team lead Briefing at shift start. All operators report to floor supervisor for daily targets.",
                "Inventory count tonight after second shift. Secure all parts in designated bins before leaving.",
                "New employee orientations this week. Please welcome trainees and assist with station familiarization.",
                "Production targets adjusted for Q1. Current efficiency metrics posted on the dashboard."
            ],
            maintenance: [
                "Line 2 Station 4 robotic arm recalibrated. Test cycle required before production restart.",
                "Compressed air pressure fluctuation detected. Pneumatic tools on Line 3 may require adjustment.",
                "Conveyor belt tension adjusted on Line 1. Report any unusual noise or belt tracking issues.",
                "Backup generator test scheduled for tonight at midnight. Brief power interruption expected.",
                "Tool crib restocked with new torque wrenches. Old units with red tags should be returned.",
                "Line 3 emergency lighting replaced. All exit paths illuminated and verified operational.",
                "HVAC system maintenance completed. Temperature should stabilize in Assembly Area B within 2 hours.",
                "Hydraulic press on Line 2 serviced. Pressure gauges recalibrated to factory specifications.",
                "New safety interlock installed on Line 1 station 6. Sensor must detect presence before operation.",
                "Floor marking paint refreshed in all work zones. Stay within designated areas during operations."
            ]
        };

        // Get notification for the day
        function getDailyNotification() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            
            // Seed random with day of year for consistency
            const seed = dayOfYear;
            const categories = ['safety', 'general', 'maintenance'];
            const categoryIndex = seed % categories.length;
            const category = categories[categoryIndex];
            
            const messageArray = messages[category];
            const messageIndex = Math.floor((seed / categories.length)) % messageArray.length;
            
            return {
                type: category,
                message: messageArray[messageIndex],
                icon: category === 'safety' ? '‚ö†Ô∏è' : category === 'general' ? 'üì¢' : 'üîß',
                time: today.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })
            };
        }

        // Format date
        function formatDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date().toLocaleDateString('en-US', options);
        }

        // Load stats from localStorage
        function loadStats() {
            const stats = JSON.parse(localStorage.getItem('widgetStats') || '{"ackCount": 0, "lastAckDate": null}');
            return stats;
        }

        // Save stats to localStorage
        function saveStats(stats) {
            localStorage.setItem('widgetStats', JSON.stringify(stats));
        }

        // Check if acknowledged today
        function checkAcknowledgedToday() {
            const today = new Date().toDateString();
            const acknowledged = localStorage.getItem('acknowledgedDate');
            return acknowledged === today;
        }

        // Get today's signature data
        function getTodaySignature() {
            const today = new Date().toDateString();
            const signatures = JSON.parse(localStorage.getItem('signatures') || '[]');
            return signatures.find(sig => sig.date === today);
        }

        // Check if signature is expired (more than 1 hour old)
        function isSignatureExpired(signature) {
            if (!signature || !signature.timestamp) return true;
            const now = new Date().getTime();
            const hourInMs = 60 * 60 * 1000; // 1 hour in milliseconds
            return (now - signature.timestamp) > hourInMs;
        }

        // Render notification
        function renderNotification() {
            const notification = getDailyNotification();
            const isAcknowledged = checkAcknowledgedToday();
            const content = document.getElementById('notification-content');

            if (isAcknowledged) {
                const signature = getTodaySignature();
                
                // Check if signature exists and if it's been more than 1 hour
                if (!signature || isSignatureExpired(signature)) {
                    // Reset acknowledgment if expired or missing
                    localStorage.removeItem('acknowledgedDate');
                    renderNotification();
                    return;
                }
                
                // Collapsed/acknowledged state - minimal display
                content.innerHTML = `
                    <div class="notification-card" style="padding: 20px; text-align: center; background: #f0fdf4; border-left: 4px solid #10b981;">
                        <div style="font-size: 48px; margin-bottom: 8px;">‚úÖ</div>
                        <h3 style="font-size: 16px; font-weight: 600; color: #059669; margin: 0 0 4px 0;">Safety Alert Acknowledged</h3>
                        <p style="font-size: 13px; color: #666; margin: 0 0 12px 0;">Signed by ${signature.name} at ${signature.time}</p>
                        <button onclick="expandAcknowledgment()" style="padding: 8px 16px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; background: white; color: #666;">View Details</button>
                    </div>
                `;
            } else {
                const cardStyle = `padding: 20px; border-bottom: 1px solid #e5e5e5; ${notification.type === 'safety' ? 'background: #fef2f2; border-left: 4px solid #dc2626;' : ''}`;
                const iconBgColor = notification.type === 'safety' ? '#dc2626' : (notification.type === 'general' ? '#e3f2fd' : '#fff3e0');
                const iconColor = notification.type === 'safety' ? 'white' : (notification.type === 'general' ? '#1976d2' : '#f57c00');
                const typeColor = notification.type === 'safety' ? '#dc2626' : (notification.type === 'general' ? '#1976d2' : '#f57c00');
                
                content.innerHTML = `
                    <div class="notification-card" style="${cardStyle}">
                        <div class="notification-header" style="display: flex; align-items: center; gap: 12px; margin-bottom: 14px;">
                            <div class="notification-icon" style="width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; background: ${iconBgColor}; color: ${iconColor};">
                                ${notification.icon}
                            </div>
                            <div class="notification-meta" style="flex: 1;">
                                <div class="notification-type" style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; color: ${typeColor};">${notification.type}</div>
                                <div class="notification-time" style="font-size: 11px; color: #666;">${notification.time}</div>
                            </div>
                        </div>
                        <div class="notification-message" style="font-size: 14px; line-height: 1.6; color: #333; margin-bottom: 16px;">
                            ${notification.message}
                        </div>
                        <div class="notification-actions" style="display: flex; gap: 12px;">
                            <button class="btn btn-primary btn-full" onclick="openSignatureModal()" style="width: 100%; padding: 12px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white;">Acknowledge & Sign</button>
                        </div>
                    </div>
                `;
            }
        }

        // Expand acknowledgment to show full details
        function expandAcknowledgment() {
            const notification = getDailyNotification();
            const signature = getTodaySignature();
            const content = document.getElementById('notification-content');
            
            const cardStyle = `padding: 20px; border-bottom: 1px solid #e5e5e5; ${notification.type === 'safety' ? 'background: #fef2f2; border-left: 4px solid #dc2626;' : ''}`;
            const iconBgColor = notification.type === 'safety' ? '#dc2626' : (notification.type === 'general' ? '#e3f2fd' : '#fff3e0');
            const iconColor = notification.type === 'safety' ? 'white' : (notification.type === 'general' ? '#1976d2' : '#f57c00');
            const typeColor = notification.type === 'safety' ? '#dc2626' : (notification.type === 'general' ? '#1976d2' : '#f57c00');
            
            content.innerHTML = `
                <div class="notification-card" style="${cardStyle}">
                    <div class="notification-header" style="display: flex; align-items: center; gap: 12px; margin-bottom: 14px;">
                        <div class="notification-icon" style="width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; background: ${iconBgColor}; color: ${iconColor};">
                            ${notification.icon}
                        </div>
                        <div class="notification-meta" style="flex: 1;">
                            <div class="notification-type" style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; color: ${typeColor};">${notification.type}</div>
                            <div class="notification-time" style="font-size: 11px; color: #666;">${notification.time}</div>
                        </div>
                    </div>
                    <div class="notification-message" style="font-size: 14px; line-height: 1.6; color: #333; margin-bottom: 16px;">
                        ${notification.message}
                    </div>
                    <div class="signature-section" style="margin-top: 16px; padding-top: 16px; border-top: 2px dashed #e5e5e5;">
                        <div class="signature-label" style="font-size: 11px; color: #666; margin-bottom: 8px; font-weight: 600;">DIGITALLY ACKNOWLEDGED BY:</div>
                        <div class="signature-display" style="background: white; border: 2px solid #dc2626; border-radius: 8px; padding: 12px; text-align: center; font-size: 15px; font-weight: 600; min-height: 50px; display: flex; align-items: center; justify-content: center;">
                            ${signature.name}
                        </div>
                        ${signature.signature ? `<div style="text-align: center; margin-top: 10px;"><img src="${signature.signature}" alt="Signature" style="max-width: 100%; height: 70px; border: 2px solid #dc2626; border-radius: 8px; background: white; padding: 6px;"></div>` : ''}
                        <div class="digital-signature-info" style="display: flex; gap: 10px; margin-top: 10px; font-size: 10px; color: #666;">
                            <div class="signature-info-item" style="flex: 1; background: #f9f9f9; padding: 6px; border-radius: 6px;">
                                <div class="signature-info-label" style="font-weight: 600; margin-bottom: 2px;">Time</div>
                                <div>${signature.time}</div>
                            </div>
                            <div class="signature-info-item" style="flex: 1; background: #f9f9f9; padding: 6px; border-radius: 6px;">
                                <div class="signature-info-label" style="font-weight: 600; margin-bottom: 2px;">Date</div>
                                <div>${signature.dateFormatted}</div>
                            </div>
                            <div class="signature-info-item" style="flex: 1; background: #f9f9f9; padding: 6px; border-radius: 6px;">
                                <div class="signature-info-label" style="font-weight: 600; margin-bottom: 2px;">Status</div>
                                <div>‚úì Verified</div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; text-align: center;">
                        <button onclick="collapseAcknowledgment()" style="padding: 8px 16px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; background: white; color: #666;">Collapse</button>
                        <button onclick="toggleSignageBoard()" style="margin-left: 8px; padding: 8px 16px; border: 1px solid #1e293b; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; background: #1e293b; color: white;">View All Signatures</button>
                    </div>
                </div>
            `;
        }

        // Collapse acknowledgment back to compact view
        function collapseAcknowledgment() {
            renderNotification();
        }

        // Update stats display (stats removed but keeping function for compatibility)
        function updateStatsDisplay() {
            // Stats bar removed - keeping function stub for compatibility
        }

        // Open signature modal
        function openSignatureModal() {
            const modal = document.createElement('div');
            modal.className = 'signature-modal';
            modal.id = 'signature-modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px;';
            
            modal.innerHTML = `
                <div class="signature-modal-content" style="background: white; border-radius: 16px; max-width: 500px; width: 100%; overflow: hidden; animation: slideUp 0.3s ease;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 20px; text-align: center;">
                        <h2 style="font-size: 18px; margin: 0 0 4px 0;">Digital Signature Required</h2>
                        <p style="font-size: 13px; opacity: 0.9; margin: 0;">Please enter your name and sign below</p>
                    </div>
                    <div class="modal-body" style="padding: 24px;">
                        <div class="input-group" style="margin-bottom: 20px;">
                            <label class="input-label" style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">Full Name *</label>
                            <input type="text" id="employee-name" class="input-field" placeholder="Enter your full name" autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e5e5e5; border-radius: 8px; font-size: 15px; font-family: inherit; box-sizing: border-box;">
                        </div>
                        <div class="input-group" style="margin-bottom: 20px;">
                            <label class="input-label" style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">Signature *</label>
                            <div class="canvas-container" style="border: 2px solid #dc2626; border-radius: 8px; background: white; margin-bottom: 12px; touch-action: none;">
                                <canvas id="signature-canvas" width="452" height="200" style="display: block; width: 100%; cursor: crosshair; touch-action: none;"></canvas>
                            </div>
                            <div class="canvas-instructions" style="font-size: 12px; color: #666; text-align: center; margin-bottom: 16px;">
                                Draw your signature using your finger or stylus
                            </div>
                        </div>
                        <div class="modal-actions" style="display: flex; gap: 12px;">
                            <button class="btn btn-clear" onclick="clearSignature()" style="flex: 1; padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; background: #f5f5f5; color: #666;">Clear Signature</button>
                            <button class="btn btn-primary" onclick="submitSignature()" style="flex: 1; padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white;">Submit</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            initializeCanvas();
        }

        // Initialize canvas for drawing
        let canvas, ctx, isDrawing = false;
        let hasSignature = false;

        function initializeCanvas() {
            canvas = document.getElementById('signature-canvas');
            ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#dc2626';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            hasSignature = true;
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
            hasSignature = true;
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
            ctx.stroke();
        }

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
        }

        function closeModal() {
            const modal = document.getElementById('signature-modal');
            if (modal) {
                modal.remove();
            }
        }

        function submitSignature() {
            const name = document.getElementById('employee-name').value.trim();
            
            if (!name) {
                alert('Please enter your full name');
                return;
            }

            if (!hasSignature) {
                alert('Please provide your signature');
                return;
            }

            // Save signature as image
            const signatureImage = canvas.toDataURL();
            acknowledgeNotification(name, signatureImage);
            closeModal();
        }

        // Acknowledge notification
        function acknowledgeNotification(userName, signatureImage) {
            const today = new Date().toDateString();
            const now = new Date();
            localStorage.setItem('acknowledgedDate', today);

            // Save signature
            const signatures = JSON.parse(localStorage.getItem('signatures') || '[]');
            
            // Add new signature
            signatures.push({
                name: userName,
                signature: signatureImage,
                date: today,
                dateFormatted: now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                time: now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                timestamp: now.getTime()
            });

            // Keep only last 100 signatures
            if (signatures.length > 100) {
                signatures.shift();
            }

            localStorage.setItem('signatures', JSON.stringify(signatures));

            let stats = loadStats();
            stats.ackCount++;
            stats.lastAckDate = today;
            saveStats(stats);

            renderNotification();
            updateStatsDisplay();
        }

        // Toggle signage board
        function toggleSignageBoard() {
            const board = document.getElementById('signage-board');
            if (board.style.display === 'none') {
                renderSignageBoard();
                board.style.display = 'block';
            } else {
                board.style.display = 'none';
            }
        }

        // Render signage board
        function renderSignageBoard() {
            const today = new Date().toDateString();
            const signatures = JSON.parse(localStorage.getItem('signatures') || '[]');
            const todaySignatures = signatures.filter(sig => sig.date === today);
            const board = document.getElementById('signage-board');

            let signaturesHTML = '';
            if (todaySignatures.length === 0) {
                signaturesHTML = '<div class="no-signatures" style="text-align: center; padding: 40px 20px; opacity: 0.6;">No acknowledgments yet today</div>';
            } else {
                signaturesHTML = todaySignatures.map(sig => `
                    <div class="signage-item" style="background: rgba(255, 255, 255, 0.1); padding: 12px 16px; border-radius: 8px; display: flex; flex-direction: column; align-items: flex-start; gap: 8px; backdrop-filter: blur(10px);">
                        <div style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
                            <div>
                                <div class="signage-name" style="font-weight: 600; font-size: 14px;">${sig.name}</div>
                                <div class="signage-time" style="font-size: 12px; opacity: 0.7;">${sig.time}</div>
                            </div>
                            <div class="signage-badge" style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">‚úì SIGNED</div>
                        </div>
                        ${sig.signature ? `<img src="${sig.signature}" alt="Signature" style="max-width: 200px; height: 60px; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; background: white; padding: 4px;">` : ''}
                    </div>
                `).join('');
            }

            board.innerHTML = `
                <div class="signage-board" style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 24px; color: white;">
                    <div class="signage-header" style="text-align: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid rgba(255, 255, 255, 0.2);">
                        <h2 style="font-size: 18px; font-weight: 600; margin: 0 0 4px 0;">üìã Digital Signage Board</h2>
                        <p style="font-size: 13px; opacity: 0.8; margin: 0;">Today's Acknowledgments: ${todaySignatures.length}</p>
                    </div>
                    <div class="signage-list" style="display: flex; flex-direction: column; gap: 12px; max-height: 300px; overflow-y: auto;">
                        ${signaturesHTML}
                    </div>
                </div>
                <button class="toggle-signage-btn" onclick="toggleSignageBoard()" style="width: 100%; padding: 16px; background: #1e293b; color: white; border: none; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.2s;">
                    Hide Signage Board
                </button>
            `;
        }

        // Dismiss notification (removed functionality)
        function dismissNotification() {
            // This function is no longer used - acknowledgment is required
        }

        // Initialize widget
        function initWidget() {
            document.getElementById('current-date').textContent = formatDate();
            renderNotification();
            updateStatsDisplay();
        }

        // Run on load
        initWidget();

        // Check for new day every minute
        setInterval(() => {
            const currentDate = new Date().toDateString();
            const acknowledgedDate = localStorage.getItem('acknowledgedDate');
            
            // Check if it's a new day OR if signature has expired
            if (acknowledgedDate !== currentDate) {
                location.reload();
            } else if (acknowledgedDate === currentDate) {
                const signature = getTodaySignature();
                if (isSignatureExpired(signature)) {
                    localStorage.removeItem('acknowledgedDate');
                    location.reload();
                }
            }
        }, 60000);
    </script>
</body>
</html>
